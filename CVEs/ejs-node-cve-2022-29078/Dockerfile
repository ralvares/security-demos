FROM  registry.access.redhat.com/ubi9/nodejs-22-minimal

# Create app directory (using UBI standard path)
WORKDIR /opt/app-root/src

# Switch to root for installation
USER 0

# Install app dependencies
# A wildcard is used to ensure both package.json AND package-lock.json are copied
# where available (npm@5+)
COPY package*.json ./

RUN npm install -S express ejs@3.1.6
RUN npm install -g nc

# Change ownership to default user
RUN chown -R 1001:0 /opt/app-root/src

# Switch back to default user
USER 1001

# Bundle app source
COPY . .

EXPOSE 8080
CMD [ "node", "app.js" ]
